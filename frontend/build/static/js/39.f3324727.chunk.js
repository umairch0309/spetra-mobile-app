(this.webpackJsonpclouddoc=this.webpackJsonpclouddoc||[]).push([[39],{1045:function(e,t,n){},1230:function(e,t,n){"use strict";n.r(t);var c=n(16),i=n.n(c),a=n(25),o=n(118),r=n(0),s=n(107),l=n(27),d=n(934),u=n.n(d),j=n(15),f=n(28),b=n(183),v=n(1192),m=n(618),O=n(397),h=n(18),x=n.n(h),p=n(34),g=n(17),N=n(3),k=function(e){var t=e.participant,n=e.isAudio,c=void 0===n||n,i=e.isVideo,a=void 0===i||i,s=e.localUser,l=e.isVoiceCall,d=Object(r.useState)([]),u=Object(o.a)(d,2),j=u[0],f=u[1],v=Object(r.useState)([]),m=Object(o.a)(v,2),O=m[0],h=m[1],x=Object(r.useState)(!1),p=Object(o.a)(x,2),g=p[0],k=p[1],w=Object(r.useRef)(),C=Object(r.useRef)(),E=function(e){return Array.from(e.values()).map((function(e){return e.track})).filter((function(e){return null!==e}))},D=function(e){"video"===e.kind?f((function(t){return[].concat(Object(b.a)(t),[e])})):"audio"===e.kind&&h((function(t){return[].concat(Object(b.a)(t),[e])}))},y=function(e){"video"===e.kind?f((function(t){return t.filter((function(t){return t!==e}))})):"audio"===e.kind&&h((function(t){return t.filter((function(t){return t!==e}))}))};return Object(r.useEffect)((function(){return f(E(t.videoTracks)),h(E(t.audioTracks)),t.on("trackSubscribed",D),t.on("trackUnsubscribed",y),function(){f([]),h([]),t.removeAllListeners()}}),[t]),Object(r.useEffect)((function(){var e=j[0];if(e){e.on("disabled",(function(){k(!0)})),e.on("enabled",(function(){k(!1),e.attach(w.current)}));var t=e.isEnabled;if(a){if(!t)try{e.enable()}catch(n){console.log(n)}e.attach(w.current)}else e.disable();return function(){e.detach()}}}),[j,a]),Object(r.useEffect)((function(){var e=O[0];if(e)return e.on("disabled",(function(){e.detach()})),e.on("enabled",(function(){e.attach(C.current)})),c?(!e.isEnabled&&e.enable(),e.attach(C.current)):e.disable(),function(){e.detach()}}),[O,c]),Object(r.useEffect)((function(){var e=j[0];if(l&&e)try{e.disable(),e.detach()}catch(t){console.log(t)}return function(){}}),[]),Object(N.jsx)(N.Fragment,{children:s?Object(N.jsxs)(N.Fragment,{children:[a?Object(N.jsx)("video",{ref:w,autoPlay:!0}):Object(N.jsx)("div",{className:"camOff centerFlex",children:" Cam off "}),Object(N.jsx)("audio",{ref:C,autoPlay:!0,muted:!c})]}):Object(N.jsxs)(N.Fragment,{children:[g?Object(N.jsx)("div",{className:"title",children:"Participant have turned off thier Cam"}):Object(N.jsx)(N.Fragment,{children:Object(N.jsx)("video",{ref:w,autoPlay:!0})}),Object(N.jsx)("audio",{ref:C,autoPlay:!0,muted:!1})]})})},w=function(e){var t,n,c,i,a,s,l,d=e.roomName,u=e.room,h=e.handleLogout,w=e.userId,C=e.role,E=Object(r.useState)([]),D=Object(o.a)(E,2),y=D[0],P=D[1],L=Object(r.useState)(!0),S=Object(o.a)(L,2),F=S[0],T=S[1],A=Object(r.useState)(!0),B=Object(o.a)(A,2),I=B[0],R=B[1],U=Object(O.a)("bookingDetails",(function(){return Object(f.c)(),j.a.get("/booking/".concat(d),J)}),{staleTime:6e3}),V=U.isLoading,J=U.data,M=null===J||void 0===J?void 0:J.data,_="None"!==(null===M||void 0===M||null===(t=M.doctorData)||void 0===t||null===(n=t.image)||void 0===n?void 0:n.url)&&f.d+(null===M||void 0===M||null===(c=M.doctorData)||void 0===c||null===(i=c.image)||void 0===i?void 0:i.url);Object(r.useEffect)((function(){var e=function(e){P((function(t){return[].concat(Object(b.a)(t),[e])}))},t=function(e){P((function(t){return t.filter((function(t){return t!==e}))}))};return u.on("participantConnected",e),u.on("participantDisconnected",t),u.participants.forEach(e),function(){u.off("participantConnected",e),u.off("participantDisconnected",t)}}),[u]);var W=1===y.length?y.map((function(e){return Object(N.jsx)(k,{participant:e},e.sid)})):Object(N.jsx)("div",{className:"title",children:" Waiting for other participant to join ."});return Object(N.jsx)(N.Fragment,{children:Object(N.jsx)("div",{className:"container-fluid headerPadding  ",children:Object(N.jsxs)("div",{className:"row basicRow waitingRoom px-0",children:[Object(N.jsx)("div",{className:" col-lg-8 col-md-12 col-sm-12",children:Object(N.jsxs)("div",{className:"videoDiv",children:[Object(N.jsxs)("div",{className:"videoControls",children:[Object(N.jsx)("button",{onClick:function(){return T(!F)},className:F?"":"active",children:Object(N.jsx)("img",{src:"/images/video.svg",alt:"video",className:"icon"})}),Object(N.jsx)("button",{onClick:function(){return R((function(e){return!e}))},className:I?"":"active",children:Object(N.jsx)("img",{src:"/images/mic.svg",alt:"audio",className:"icon"})})]}),W,Object(N.jsx)("div",{className:"myVideoDiv",children:Object(N.jsx)(k,{localUser:!0,isAudio:I,isVideo:F,participant:u.localParticipant},u.localParticipant.sid)})]})}),V||Object(N.jsxs)("div",{className:"col-lg-4 col-md-12  col-sm-12",children:[function(){var e,t;C&&w!==(null===M||void 0===M||null===(e=M.doctorData)||void 0===e?void 0:e._id)&&w!==(null===M||void 0===M||null===(t=M.patientData)||void 0===t?void 0:t._id)&&(x.a.fire("Meeting Expired","","error"),g.a.push("doctor"===C?"/doc/consulation":"/pat/consulation"))}(),Object(N.jsxs)("div",{className:" flexCenter header",children:[Object(N.jsx)("img",{src:_||p.c,alt:"profile",className:"img"}),Object(N.jsxs)("div",{className:"ml-2",children:[Object(N.jsx)("div",{className:"waitingText",children:"Consulation room of"}),Object(N.jsxs)("div",{className:"name",children:["Dr. ",null===M||void 0===M||null===(a=M.doctorData)||void 0===a?void 0:a.name]}),Object(N.jsx)("div",{className:"workText",children:"Doctor"})]})]}),Object(N.jsxs)("div",{className:"flexBetweenCenter detailsDiv",children:[Object(N.jsxs)("div",{className:"item",children:[Object(N.jsx)("div",{className:"title",children:"Patient"}),Object(N.jsxs)("div",{className:"text",children:[" ",null===M||void 0===M||null===(s=M.patientData)||void 0===s?void 0:s.name]})]}),Object(N.jsxs)("div",{className:"item",children:[Object(N.jsx)("div",{className:"title",children:"Appointment time"}),Object(N.jsx)("div",{className:"text",children:Object(v.a)(Object(m.a)(null===M||void 0===M||null===(l=M.bookingDate)||void 0===l?void 0:l.start),"Pp")})]})]}),Object(N.jsx)("button",{onClick:function(){x.a.fire({title:"Are you sure?",text:"you wanna leave meeting ?",icon:"warning",showCancelButton:!0,cancelButtonText:"No",confirmButtonText:"Yes",confirmButtonColor:"#c82333"}).then((function(e){e.isConfirmed&&h()}))},className:"btn btn-danger w-100",children:"Leave Meeting"})]})]})})})},C=n(154);n(1045),t.default=function(){var e=Object(l.c)((function(e){return e.auth})).user,t=null===e||void 0===e?void 0:e.role,n=new URLSearchParams(Object(s.h)().search),c=n.get("roomId"),d=n.get("name"),b=Object(r.useState)(null),v=Object(o.a)(b,2),m=v[0],O=v[1],h=Object(r.useState)(!1),x=Object(o.a)(h,2),p=(x[0],x[1]);Object(r.useEffect)((function(){(function(){var e=Object(a.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!0),e.prev=1,Object(f.c)(),e.next=5,j.a.post("/videoChat/video/token",{name:d,bookingId:c});case 5:t=e.sent,u.a.connect(t.data.token,{name:c}).then((function(e){p(!1),O(e)})),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),console.error(e.t0),p(!1);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}})()()}),[c,d]);var k=Object(r.useCallback)((function(){O((function(e){return e&&(e.localParticipant.tracks.forEach((function(e){e.track.stop()})),e.disconnect(),g.a.push("doctor"===t?"/dashboard/consulation":"/dashboard/consulation?review=true&&bookingId=".concat(c))),null}))}),[]);return Object(r.useEffect)((function(){if(m){var e=function(e){e.persisted||m&&k()};return window.addEventListener("pagehide",e),window.addEventListener("beforeunload",e),function(){window.removeEventListener("pagehide",e),window.removeEventListener("beforeunload",e)}}}),[m,k]),m?Object(N.jsx)(w,{userId:d,roomName:c,room:m,handleLogout:k,role:t}):Object(N.jsx)(C.a,{})}},154:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n(0);var c=n(296),i=n(3);function a(e){var t=e.height,n=void 0===t?"80vh":t;return Object(i.jsx)("div",{className:"centerFlex",style:{height:n,width:"100%"},children:Object(i.jsx)(c.a,{})})}}}]);
//# sourceMappingURL=39.f3324727.chunk.js.map